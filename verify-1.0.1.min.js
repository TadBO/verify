"use strict";var _createClass=function(){function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Verify=function(){function e(t){_classCallCheck(this,e),this.oBar=null,this.oCon=null,this.oImg=null,this.oBtn=null,this.oRignt=null,this.oError=null,this.oBgImg=null,this.tips=null,this.token=null,this.mask=null,this.callback=t.callback||function(){},this.el="body",this.imgUrl=t.imgUrl,this.checkUrl=t.checkUrl;try{if(!this.imgUrl||!this.checkUrl||"function"!=typeof this.callback)throw new Error("参数异常！")}catch(t){return console.log(t),!1}this.init()}return _createClass(e,[{key:"init",value:function(){this.styles(),this.draw(),this.event(this.callback)}},{key:"draw",value:function(){var t=document.createElement("div");t.setAttribute("class","mask"),t.innerHTML='<div class="wrap"><div class="verify" id="Verify">\n\t\t\t\t<div class="verify_bar">\n\t\t\t\t\t<p class="verify_btn"></p>\n\t\t\t\t\t<p class="verify_txt">向右滑动滑块填充拼图</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="verify_con">\n\t\t\t\t\t<div class="verify_slide_img"></div>\n\t\t\t\t\t<div class="verify_slide_bg"><img class="bg_img"/></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="verify_tips">\n\t\t\t\t\t<p class="verify_res verify_right">验证成功</p>\n\t\t\t\t\t<p class="verify_res verify_error">验证失败</p>\n\t\t\t\t</div>\n\t\t\t</div></div>',document.querySelector(this.el).appendChild(t),this.oBar=document.querySelector(".verify_bar"),this.oCon=document.querySelector(".verify_con"),this.oImg=document.querySelector(".verify_slide_img"),this.oBtn=document.querySelector(".verify_btn"),this.oRignt=document.querySelector(".verify_right"),this.oError=document.querySelector(".verify_error"),this.oBgImg=document.querySelector(".bg_img"),this.tips=document.querySelector(".verify_txt"),this.options=document.querySelector(".verify_tips"),this.mask=document.querySelector(".mask")}},{key:"styles",value:function(){var t=document.createElement("style");t.innerHTML="body,html{margin: 0;padding: 0;}\n                            .mask { width: 100%; height: 100%; position: fixed; left: 0; top: 0;background: rgba(0,0,0,.4); z-index: 999; display: none;}\n                            .wrap{width: 500px;padding-top: 200px;position: absolute; left: 50%; margin-left: -250px; top: 50%; margin-top: -137px;background:#fff;padding-bottom: 40px;}\n                            .verify{position: relative;width: 300px;margin: 0 auto;}\n                            .verify_bar{height: 34px;width: 300px;position: relative;border: 1px solid #ccc;background: #eee;line-height: 34px;text-align: center;box-sizing: border-box;}\n                            .verify_btn{position: absolute;height: 100%;width: 35px;left: 0px;cursor: pointer;padding: 0;margin: 0;background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAzUlEQVQ4T93TMQrCMBQG4P/v6jW8g7Nu4uTiomcwr64uXZ3SdHfxCiIIjnoCB8/RE/RJBItCCwlkEDO/fPC//CESHyb28GegiGyapnlUVXXuW1VUZBHZqWoOYOacu3ShUSAAGmP2AFZ9aCyIoiiyuq4PqrroQqNBH/MTJTkvy/L0jt+CeZ4PVXXpYwV2MwOwBjBQ1bFz7ubvtZeNMSOS00DMj7UgyYm19voFRkBhkUPB1I+StjbJiy0iW5J3a+0xydcL2XNo50Ks18zvg08WzGMVsuSGVQAAAABJRU5ErkJggg==) center center no-repeat;background-color: #fff;}\n                             .verify_btn:hover {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAr0lEQVQ4T93TMQ5BQRSF4f9obcMe1HSi0mhYg+RprcAiNLYgEomSFShs58gU5JF58q6MREw9+XLPnTOi8FFhjz8DbS+Bq6RD06pCkW2vgQoYSzrm0CiY7m+AeRMaAtNEtjvAFpjm0DCYQSeS9vf4D9B2D5hB6yqlSRdAFxhIOie0DvaBUaDodXAo6fQEBqDXPeYjtwWLPortsrX5RrFXwEXSrsjXa7Pnj4r9Dv598AZDHjwV3Xu4TQAAAABJRU5ErkJggg==) center center no-repeat; background-color: #1991fa;}\n                            .verify_bar:hover { border-color:  #1991fa;}   \n                            .verify_txt{padding: 0;margin: 0;font-size: 12px;color: #999;}\n                            .verify_con{position: absolute;width: 100%;height: 150px;bottom: 44px;left: 0;}\n                            .verify_slide_img{position: absolute;height: 100%;width: 76px;left: 0;background-position: 0px 21px;background-repeat: no-repeat;}\n                            .verify_tips{position: absolute;left: 100%;top: 0;padding-left: 15px;padding-top: 9px;}\n                            .verify_res{padding-left: 18px;font-size: 12px;width: 80px;display:none;margin: 0;}\n                            .verify_right{color: #8ec571;background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDAwQjFFOTJERDAyMTFFNUEyMDNDNjkwQTE2RjIzQjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NDAwQjFFOTNERDAyMTFFNUEyMDNDNjkwQTE2RjIzQjAiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0MDBCMUU5MEREMDIxMUU1QTIwM0M2OTBBMTZGMjNCMCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0MDBCMUU5MUREMDIxMUU1QTIwM0M2OTBBMTZGMjNCMCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PkOQ1v8AAAEISURBVHjaYuw7WsiABESAuAiIfYBYDSp2A4g3AfEkIH4DU8iCpCkYiOcCMT8DKtCH4nwgTgLitSBBJiRNq7FoQgZ8UDXBMI2iQDwPiBkZCANGqFoxkMZcqGmEwE0g9oaqLQD50Y8ITVeBOBuIF0P5PiAbNZAUHMWi6TxU0wogloWKqTOhKVoKxBOQ+CeBuASI1wCxBJL4LyZoPMHAVCB+BMTtQHwEiGuhmkTQLLjHBI1c5FDrA+KvQNwA1SSIxflbQRqnAPEnNIkWIN6DI7RBaieANL6Cpoj/RITuf6jaV7DAASWjMCD+jEcTSC4UPckxQP2jBA2YK0D8G+rX81CnK8E0gQBAgAEALbA1DQUbguQAAAAASUVORK5CYII=) left center no-repeat;}\n                            .verify_error{color: #fa5b5b;background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTg0OTk4RDdERDAyMTFFNUEyMDNDNjkwQTE2RjIzQjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NTg0OTk4RDhERDAyMTFFNUEyMDNDNjkwQTE2RjIzQjAiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0MDBCMUU5OEREMDIxMUU1QTIwM0M2OTBBMTZGMjNCMCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo1ODQ5OThENkREMDIxMUU1QTIwM0M2OTBBMTZGMjNCMCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhKYxrsAAAEpSURBVHjadJK9SkNBEIVz5bZqo3kAwZ9CSG2jwUItgk3UJo0/tSg2VnaCYClopy+gaYSANqLd7Sy0iAg+QLBStLgi12/gLIzLzcAHy8w5u7O7k+StVsXFCOxBAyaU68I1nMB7EKbO1IRzGK78j5rYgU1oW3LAmS5LTD6GpGkG4yhcQAI5ZCWmTLVE2qoZt7VbEMzDrTPdKJe5k3ftjstONAunaqcDBazAmWohGmacitragG9taMZjWI80k2mfh5iBX7eOI0/1TzWXfIIl2NeJi3AH007zlupzg/FTwi04UO4LFuAFBpXrJExOlcWre9l7qEetPcCc1h8wbt/R00QUKtRL7hRMhbS9MDk2RmtqtV9YbTUeOYsrGIMjeIYf3e8RDlVrB/GfAAMAMPw/kb33l20AAAAASUVORK5CYII=) left center no-repeat;}",document.querySelector("head").appendChild(t)}},{key:"showImg",value:function(){var e=this;this.oBtn.style.left="0px",this.oImg.style.left="0px",this.oRignt.style.display="none",this.oError.style.display="none",this.ajax({type:"GET",url:this.imgUrl},function(t){0==t.state&&(e.oImg.style.backgroundImage="url(data:image/png;base64,"+t.data.moveSrc+")",e.oImg.style.backgroundPositionY=t.data.posY+"px",e.oBgImg.setAttribute("src","data:image/png;base64,"+t.data.bgSrc),e.token=t.data.token,e.mask.style.display="block")})}},{key:"event",value:function(n){var r=this,e=void 0,i=void 0,l=!1;this.oBtn.onmousedown=function(t){t.stopPropagation(),e=t.clientX-r.oBtn.getBoundingClientRect().left,l=!0,r.tips.style.display="none"},this.oBtn.ontouchstart=function(t){t.stopPropagation(),e=t.touches[0].clientX-r.oBtn.getBoundingClientRect().left,l=!0,r.tips.style.display="none",r.oBtn.style.background="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAr0lEQVQ4T93TMQ5BQRSF4f9obcMe1HSi0mhYg+RprcAiNLYgEomSFShs58gU5JF58q6MREw9+XLPnTOi8FFhjz8DbS+Bq6RD06pCkW2vgQoYSzrm0CiY7m+AeRMaAtNEtjvAFpjm0DCYQSeS9vf4D9B2D5hB6yqlSRdAFxhIOie0DvaBUaDodXAo6fQEBqDXPeYjtwWLPortsrX5RrFXwEXSrsjXa7Pnj4r9Dv598AZDHjwV3Xu4TQAAAABJRU5ErkJggg==) center center no-repeat;",r.oBtn.style.backgroundColor="#1991fa",r.oBar.style.borderColor="#1991fa"},document.querySelector("body").onmousemove=function(t){if(t.stopPropagation(),!l)return!1;(i=t.clientX-e-r.oBar.getBoundingClientRect().left)<=0?i=0:i>=r.oBar.clientWidth-r.oBtn.clientWidth&&(i=r.oBar.clientWidth-r.oBtn.clientWidth),r.oBtn.style.left=i+"px",r.oImg.style.left=i+"px"},document.querySelector("body").ontouchmove=function(t){if(t.stopPropagation(),!l)return!1;(i=t.touches[0].clientX-e-r.oBar.getBoundingClientRect().left)<=0?i=0:i>=r.oBar.clientWidth-r.oBtn.clientWidth&&(i=r.oBar.clientWidth-r.oBtn.clientWidth),r.oBtn.style.left=i+"px",r.oImg.style.left=i+"px"},document.querySelector("body").onmouseup=function(t){if(!l)return!1;t.stopPropagation(),r.tips.style.display="block",l=!1;var e=r.oBtn.offsetLeft,i=null,o=0;r.ajax({type:"POST",url:r.checkUrl,data:{x:r.oImg.offsetLeft,token:r.token}},function(t){0==t.state?(r.oRignt.style.display="block",r.oError.style.display="none",i=setTimeout(function(){r.mask.style.display="none"},1e3),n(t)):(r.oError.style.display="block",r.oRignt.style.display="none",setTimeout(function(){r.oError.style.display="none",clearInterval(i),i=setInterval(function(){o++,r.oBtn.style.left=e-o+1+"px",r.oImg.style.left=e-o+"px",e-o<1&&(r.showImg(),clearInterval(i))},4)},500),o=0)})},document.querySelector("body").ontouchend=function(t){if(!l)return!1;t.stopPropagation(),r.tips.style.display="block",r.options.style.left="-11px",r.options.style.top="34px",r.oBtn.style.background="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAzUlEQVQ4T93TMQrCMBQG4P/v6jW8g7Nu4uTiomcwr64uXZ3SdHfxCiIIjnoCB8/RE/RJBItCCwlkEDO/fPC//CESHyb28GegiGyapnlUVXXuW1VUZBHZqWoOYOacu3ShUSAAGmP2AFZ9aCyIoiiyuq4PqrroQqNBH/MTJTkvy/L0jt+CeZ4PVXXpYwV2MwOwBjBQ1bFz7ubvtZeNMSOS00DMj7UgyYm19voFRkBhkUPB1I+StjbJiy0iW5J3a+0xydcL2XNo50Ks18zvg08WzGMVsuSGVQAAAABJRU5ErkJggg==) center center no-repeat;",r.oBtn.style.backgroundColor="#fff",r.oBar.style.borderColor="#ccc",l=!1;var e=r.oBtn.offsetLeft,i=null,o=0;r.ajax({type:"POST",url:r.checkUrl,data:{x:r.oImg.offsetLeft,token:r.token}},function(t){0==t.state?(r.oRignt.style.display="block",r.oError.style.display="none",i=setTimeout(function(){r.mask.style.display="none"},1e3),n(t)):(r.oError.style.display="block",r.oRignt.style.display="none",setTimeout(function(){r.oError.style.display="none",clearInterval(i),i=setInterval(function(){o++,r.oBtn.style.left=e-o+1+"px",r.oImg.style.left=e-o+"px",e-o<1&&(r.showImg(),clearInterval(i))},4)},500),o=0)})},this.mask.onclick=function(t){t.target==this&&(this.style.display="none")}}},{key:"ajax",value:function(t,e){var i=new XMLHttpRequest;i.open(t.type,t.url),"GET"==t.type?i.send():(i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(this.formatParams(t.data))),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?e(JSON.parse(i.responseText)):e(i))}}},{key:"formatParams",value:function(t){var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")}},{key:"doSomething",value:function(t){return t}},{key:"showVerify",value:function(){this.showImg()}}]),e}();